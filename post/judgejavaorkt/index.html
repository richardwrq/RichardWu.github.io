<!DOCTYPE html>
<html lang="zh">

<head>
	<style>
body, body.pushable {
	display: block;
	--colorBG: "#40e0d0, #ff8c00, #ff0080";
	
		background: linear-gradient(to right, var(--colorBG)) !important;
	
}
</style>
<title>
注解处理器Annotation Processor中判断Java或Kotlin类
</title>
	<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">


	
	<meta name="author" content="Richard Wu" />
	<meta name="description" content="在Android Studio中，项目编译build之后kapt会在项目的build/tmp/kapt3/stubs目录下会生成kotlin编写的类的Java“存根类”，在这些类的顶部我们可以看到有这样一个注解@kotlin.Metadata(...) @Metadata是 Kotlin 里比较特殊的一个注解。它记录了 Kotlin 代码元素的一些信息，比如 class 的可见性，function 的返回值，参数类型，property 的 lateinit，nullable 的属性等等。这些 Metadata 的信息由 kotlinc 生成，最终会以注解的形式存于 .class 文件。 所以要在注解处理器判断一个类是kotlin语言或者Java语言编写的我们可以通过判断该类是否有@Metadata注解来区分：
1 2 3 4 5 6 7  /** * if true mean this class is java class */ private fun isJavaFile(element: TypeElement): Boolean { val tmMetadata = mElements.getTypeElement(&amp;#34;kotlin.Metadata&amp;#34;).asType() return element.annotationMirrors.find { it.annotationType == tmMetadata } == null }  " />



<meta name="generator" content="Hugo 0.46" />


<link rel="shortcut icon" href="https://richardwrq.github.io/img/defaultFav.ico">


<link rel="canonical" href="https://richardwrq.github.io/post/judgejavaorkt/" />
<link rel="alternative" href="/index.xml" title="RichardWu&#39;s Blog" type="application/atom+xml" />

	<link rel="stylesheet" type="text/css" href="/css/semantic.min.css">
<link rel="stylesheet" type="text/css" href="/css/site.css">



<script>
	var colorBG =  true 
	var enabledPost = true
	
	var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
	console.log("The client device is a "+(isMobile?"mobile":"PC")+".")
</script>

</head>

<body>
	<script>
var prevBgIndex = 0;
var bodyBgSwitchIndex = 0;	

	var gradients = [
	  [],
	  ['#40e0d0', '#ff8c00', '#ff0080'], 
	  ['#3e5151', '#decba4'], 
	  ['#11998e', '#38ef7d'], 
	  ['#108dc7', '#ef8e38'], 
	  ['#fc5c7d', '#6a82fb'], 
	  ['#fc466b', '#3f5efb'], 
	  ['#c94b4b', '#4b134f'], 
	  ['#23074d', '#cc5333'] 
	]

	document.body.style.setProperty('--colorBG', connect(gradients[getRandomInt(0, gradients.length)]))


	function getRandomInt(min, max) {
	  min = Math.ceil(min)
	  max = Math.floor(max)
	  var random
	  while (1) {
	    random = Math.floor(Math.random() * (max - min)) + min
	    if (random !== prevBgIndex) {
	      prevBgIndex = random
	      break
	    }
	  }
	  return random
	}

	function connect(arr) {
	  var str = ''
	  for (var i = 0; i < arr.length; i++) {
	    if (i !== arr.length - 1) {
	      str += arr[i] + ', '
	    } else {
	      str += arr[i]
	    }
	  }
	  return str
	}
</script>

	<div id="sidebar" class="ui sidebar inverted vertical menu">
	<section id="author" class="ui top attached center aligned inverted segment">
		<div class="ui small circular image">
	
	<img src="/images/avatar.jpg">
	
</div>
<h3 class="ui header">Richard Wu<div class="sub header">A programmer.</div>
</h3>

	</section>
	
	
	<section class="ui attached center aligned inverted segment sidebar-dream-tags">		
		
<a class="ui label" href="/tags/android" title="android">android</a>

<a class="ui label" href="/tags/kotlin" title="kotlin">kotlin</a>

<a class="ui label" href="/tags/%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6" title="路由框架">路由框架</a>


	</section>	
	
	
	
	
	<section class="ui attached inverted segment sidebar-dream-categories both flexbox">
		<div class="ui inverted accordion">
				
<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93">开源库</a>     	
</div>

<div class="content">    		
	<a class="item" href="https://richardwrq.github.io/post/krouter/">
		<div>
			<i class="cocktail icon"></i>
			<p>使用Kotlin打造Android路由框架-Krouter</p>
		</div>
	</a>
</div>



		</div>
	</section>
	
	
	<section id="footer" class="ui bottom attached center aligned inverted segment">
		
<p>© 2018 RichardWu&#39;s Blog</p>
    
<p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus</a> theme.</p>


	</section>
</div>

	<div class="pusher">
		<div class="flipper">
			<div class="front">
				
<nav class="ui top secondary menu bar">
	<div class="item">
		<i class="inverted big link bullseye icon dream-flip-toggle" title="翻转"></i>
	</div>
	
	
	<div class="item">
		<a href="/">
			<i class="inverted big link home icon" title="Home"></i>
		</a>
	</div>
	
	
	
	<div class="item">
		<a href="/post">
			<i class="inverted big link archive icon" title=""></i>
		</a>
	</div>
	
	
	
	<div class="item">
		<a href="/tags">
			<i class="inverted big link tags icon" title=""></i>
		</a>
	</div>
	
	
	
	<div class="item">
		<a href="/categories">
			<i class="inverted big link cubes icon" title=""></i>
		</a>
  </div>
	

	
	
	
	<div class="ui container tablet computer only grid">
		<div class="item" onClick="$('.ui.sidebar').sidebar('setting', 'transition', 'overlay').sidebar('toggle');">
			<i class="inverted big link sidebar icon" title="Show Sidebar"></i>
		</div>
	</div>
	
</nav>

 
<div class="ui centered grid">
	<div class="sixteen wide mobile only column">	
			<div class="ui inverted accordion">
	<div id="header" class="ui inverted segment column box">
		<header id="author" class="ui top attached center aligned inverted segment">
			<div class="ui small circular image">
	
	<img src="/images/avatar.jpg">
	
</div>
<h3 class="ui header">Richard Wu<div class="sub header">A programmer.</div>
</h3>

		</header>
		<div class=" title header-title">
			
			<div id="tag-category-pop" class="ui red right corner label">		
				<i class="hand point icon down"title="点击弹出标签和分类"></i>		
			</div>
			
		</div>
		<div id="tag-category" class=" content">
			
			
			<section class="ui attached center aligned inverted segment dream-tags none flexbox">
				
<a class="ui label" href="/tags/android" title="android">android</a>

<a class="ui label" href="/tags/kotlin" title="kotlin">kotlin</a>

<a class="ui label" href="/tags/%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6" title="路由框架">路由框架</a>


			</section>
			
			
			
			
			<section class="ui attached inverted segment dream-categories both flexbox">
			<div class="inverted accordion">
					
<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/%E5%BC%80%E6%BA%90%E5%BA%93">开源库</a>     	
</div>

<div class="content">    		
	<a class="item" href="https://richardwrq.github.io/post/krouter/">
		<div>
			<i class="cocktail icon"></i>
			<p>使用Kotlin打造Android路由框架-Krouter</p>
		</div>
	</a>
</div>



			</div>
			</section>
			
			
		</div>
		<footer class="ui bottom attached center aligned inverted segment">
			
<p>© 2018 RichardWu&#39;s Blog</p>
    
<p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus</a> theme.</p>


		</footer>
	</div>
</div>
	</div>
	<div class="sixteen wide mobile fifteen wide tablet twelve wide computer column post-list">
		<section class="ui secondary top attached black segment post-head">
			<h1 class="post-title">
				注解处理器Annotation Processor中判断Java或Kotlin类
			</h1>
			<div class="sub header">
					<div><span><i class="calendar outline icon"></i>Apr 27, 2018</span></div>
					<div><span class="disqusComment"><i class="comment outline icon"></i><a href="https://richardwrq.github.io/post/judgejavaorkt/#disqus_thread" class="disqus-comment-count" data-disqus-identifier="4846d5bb38cd3b99317d76c82867a6b8"></a></span></div>
					<div><span><i class="clock outline icon"></i>1 min read</span></div>
					<div><span><i class="angle double up icon"></i>更新于 Apr 27, 2018</span></div>
			</div>
			<hr>
			
			
			
			<article class="post-content twemoji">
				<p>在Android Studio中，项目编译build之后kapt会在项目的<code>build/tmp/kapt3/stubs</code>目录下会生成kotlin编写的类的Java“存根类”，在这些类的顶部我们可以看到有这样一个注解<code>@kotlin.Metadata(...)</code>
 <code>@Metadata</code>是 Kotlin 里比较特殊的一个注解。它记录了 Kotlin 代码元素的一些信息，比如 class 的可见性，function 的返回值，参数类型，property 的 lateinit，nullable 的属性等等。这些 Metadata 的信息由 kotlinc 生成，最终会以注解的形式存于 .class 文件。
所以要在注解处理器判断一个类是kotlin语言或者Java语言编写的我们可以通过判断该类是否有<code>@Metadata</code>注解来区分：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * if true mean this class is java class
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">isJavaFile</span>(element: TypeElement): Boolean {
        <span style="color:#66d9ef">val</span> tmMetadata = mElements.getTypeElement(<span style="color:#e6db74">&#34;kotlin.Metadata&#34;</span>).asType()
        <span style="color:#66d9ef">return</span> element.annotationMirrors.find { it.annotationType == tmMetadata } == <span style="color:#66d9ef">null</span>
    }</code></pre></td></tr></table>
</div>
</div>
			</article>
		</section>
		<section class="ui secondary attached segment dream-tags">
			
			<span>暂无标签</span>
			
		</section>
		
		<section class="ui secondary attached segment share row box">
			<div class="author">
	
	<img class="avatar" src="https://richardwrq.github.io/images/avatar.jpg">
	
</div>
<div class="info grow flexbox"> 
	
	<a href="https://twitter.com/WuRichard_">
	
	<p class="name">Richard Wu</p>
	
	</a>
	
	<p class="desc">A programmer.</p>		
</div>
<section class="buttons row box">
	<div class="facebook none flexbox" href="#" onclick="window.open(
			'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
			'facebook-share-dialog',
			'width=626,height=436'); return false;">
		<button class="ui facebook button"><i class="facebook icon"></i>Share</button>
	</div>
	<div class="twitter none flexbox" onclick="window.open('https://twitter.com/intent/tweet?text=Read &quot;注解处理器Annotation Processor中判断Java或Kotlin类 &quot; by @WuRichard_ https:\/\/richardwrq.github.io\/post\/judgejavaorkt\/','_self')">
		<button class="ui twitter button"><i class="twitter icon"></i>Tweet</button>
	</div>
</section>

		</section>
		

		
		<section class="ui secondary bottom attached stacked segment disqus">
			<div id="disqus_thread"></div>
<script>
	

	var disqus_config = function () {
		this.page.url = 'https:\/\/richardwrq.github.io\/post\/judgejavaorkt\/';  
		this.page.identifier = '4846d5bb38cd3b99317d76c82867a6b8'; 
   };
	(function() { 
   	var d = document, s = d.createElement('script');
   	s.src = 'https://' + 'richardwu' + '.disqus.com/embed.js';
   	s.setAttribute('data-timestamp', +new Date());
   	(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


		</section>
		
	</div>
</div>

			</div>
			<div class="back">
				<nav class="ui top secondary menu bar">
	<div class="item">
		<i class="inverted big link bullseye icon dream-flip-toggle" title="翻转"></i>
	</div>
	
<div class="item">
	<a href="https://github.com/richardwrq" target="_blank">
		<i id="ico" class="inverted big link github icon" title="GitHub"></i>
	</a>
</div>



<div class="item">
	<a href="mailto:263454190@qq.com">
		<i id="ico" class="inverted big link mail icon" title="Email"></i>
	</a>
</div>



<div class="item">
	<a href="https://twitter.com/WuRichard_" target="_blank">
		<i id="ico" class="inverted big link twitter icon" title="Twitter"></i>
	</a>
</div>





<div class="item">
	<a href="https://medium.com/@qq263454190" target="_blank">
		<i id="ico" class="inverted big link medium icon" title="Medium"></i>
	</a>
</div>





<div class="item">
	<a href="https://www.stackoverflow.com/users/9186062/xuan-yu" target="_blank">
		<i id="ico" class="inverted big link stack overflow icon" title="Stack Overflow"></i>
	</a>
</div>






</nav>

<div class="ui centered grid about">
	<div class="sixteen wide mobile fifteen wide tablet fifteen wide computer column about">
		<section class="ui stacked segments">
			<div class="ui inverted segment">
	<article class="twemoji">
		一个程序员
	</article>
</div>

		</section>
	</div>
</div>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js"></script>


	<script src="/js/twemoji.min.js"></script>




<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-112332904-3', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



	<script id="dsq-count-scr" src="//richardwu.disqus.com/count.js" async></script>

	

	
<script>
	(function () {
	  console.log("Twemoji up and making stuff colourful!");
	  for (var b = document.getElementsByClassName("twemoji"), a = 0; a < b.length; a++) {
		twemoji.parse(b[a]);
	  }
	})();
</script>


	
<script>
		anchors.add('.post-content h1');
		anchors.add('.post-content h2');
		anchors.add('.post-content h3');
</script>

</body>

</html>